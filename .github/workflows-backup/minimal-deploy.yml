name: ğŸš€ Minimal Deploy (MVP)

on:
  workflow_run:
    workflows: ["âœ… Minimal CI (MVP)"]
    types:
      - completed
    branches: [ main ]
  workflow_dispatch:

jobs:
  # åªæœ‰åœ¨ CI æˆåŠŸæ—¶æ‰éƒ¨ç½²
  deploy:
    name: ğŸš€ Simple Deploy
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Simple deployment notification
        run: |
          echo "ğŸš€ Starting minimal deployment..."
          echo "ğŸ“Š Previous CI Status: ${{ github.event.workflow_run.conclusion }}"

      - name: Verify service is running
        run: |
          echo "ğŸ” Checking current service status..."
          if curl -f http://3.35.106.116:8000/health > /dev/null 2>&1; then
            echo "âœ… Service is already running and healthy"
            curl -s http://3.35.106.116:8000/health | python3 -c "
          import sys, json
          try:
              data = json.load(sys.stdin)
              print(f'Current Status: {data.get(\"status\", \"unknown\")}')
              print(f'Environment: {data.get(\"environment\", \"unknown\")}')
              print(f'Timestamp: {data.get(\"timestamp\", \"unknown\")}')
          except:
              print('Service responding')
          " || echo "Service responding but JSON parse failed"
          else
            echo "âš ï¸ Service not responding - may need manual intervention"
            exit 1
          fi

      - name: Deployment success
        run: |
          echo "ğŸ‰ Minimal Deployment Successful!"
          echo "âœ… Service verification passed"
          echo "ğŸŒ Service URL: http://3.35.106.116:8000"
          echo "ğŸ¥ Health Check: http://3.35.106.116:8000/health"
          echo "ğŸ“Š Deploy Status: GREEN ğŸŸ¢"
