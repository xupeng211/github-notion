server { listen 80; server_name _; return 301 https://$host$request_uri; }

server {
    listen 443 ssl http2;
    server_name _;
    ssl_certificate     /etc/nginx/certs/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;

    # Optional: limit client body size (protect against large payloads)
    client_max_body_size 1m;
    # Reasonable upstream timeouts
    proxy_read_timeout 30s;
    proxy_send_timeout 30s;
    keepalive_timeout 15s;

    # Note: To enable request rate limiting, define a zone in http{}:
    #   limit_req_zone $binary_remote_addr zone=rl_gitee:10m rate=5r/s;
    # Then uncomment the limit_req line below.

    location / {
        # Optional request rate limiting (requires zone defined in http{})
        # limit_req zone=rl_gitee burst=10 nodelay;

        proxy_pass http://app:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
    }
}
