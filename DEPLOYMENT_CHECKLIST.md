# 部署检查清单

## 1. 部署前检查

### 1.1 代码和配置检查
- [ ] 所有测试通过
- [ ] 代码审查完成
- [ ] 配置文件已更新
- [ ] 环境变量已设置
- [ ] 依赖包版本已更新
- [ ] API 版本兼容性已确认

### 1.2 基础设施准备
- [ ] AWS 账户权限已确认
- [ ] VPC 和子网已配置
- [ ] 安全组规则已设置
- [ ] ECS 集群已创建
- [ ] ECR 仓库已创建
- [ ] 负载均衡器已配置
- [ ] SSL 证书已准备

### 1.3 监控和告警
- [ ] CloudWatch 日志组已创建
- [ ] 监控指标已配置
- [ ] 告警规则已设置
- [ ] 通知渠道已测试

### 1.4 安全检查
- [ ] 安全扫描已完成
- [ ] 密钥和证书已更新
- [ ] WAF 规则已配置
- [ ] 备份已完成

## 2. 部署过程

### 2.1 数据库和存储
- [ ] 备份现有数据
- [ ] 验证备份完整性
- [ ] 准备回滚计划

### 2.2 应用部署
- [ ] 构建新版本镜像
- [ ] 推送镜像到 ECR
- [ ] 更新 ECS 任务定义
- [ ] 部署新版本服务

### 2.3 配置更新
- [ ] 更新环境变量
- [ ] 更新配置文件
- [ ] 更新密钥和证书
- [ ] 更新 DNS 记录

## 3. 部署后检查

### 3.1 服务验证
- [ ] 健康检查通过
- [ ] API 端点可访问
- [ ] Webhook 功能正常
- [ ] 数据同步正常

### 3.2 性能检查
- [ ] 响应时间正常
- [ ] CPU 使用率正常
- [ ] 内存使用率正常
- [ ] 网络延迟正常

### 3.3 监控确认
- [ ] 日志正常记录
- [ ] 指标正常收集
- [ ] 告警规则生效
- [ ] 自动扩展正常

### 3.4 安全确认
- [ ] HTTPS 正常工作
- [ ] 安全头部配置生效
- [ ] WAF 规则生效
- [ ] 访问控制正常

## 4. 回滚准备

### 4.1 回滚触发条件
- [ ] 服务不可用
- [ ] 严重性能问题
- [ ] 数据异常
- [ ] 安全漏洞

### 4.2 回滚步骤
```bash
# 1. 回滚 ECS 服务到上一个版本
aws ecs update-service \
    --cluster gitee-notion-sync-cluster \
    --service gitee-notion-sync-service \
    --task-definition gitee-notion-sync-task:PREVIOUS_VERSION

# 2. 恢复配置
aws s3 cp s3://backup-bucket/config-backup/previous/ ./config/ --recursive

# 3. 验证服务状态
aws ecs describe-services \
    --cluster gitee-notion-sync-cluster \
    --services gitee-notion-sync-service
```

## 5. 文档更新

### 5.1 更新内容
- [ ] 更新版本号
- [ ] 更新变更日志
- [ ] 更新配置文档
- [ ] 更新 API 文档

### 5.2 通知相关方
- [ ] 通知开发团队
- [ ] 通知运维团队
- [ ] 通知项目负责人
- [ ] 通知相关用户

## 6. 性能优化

### 6.1 资源优化
- [ ] 检查并优化 CPU 使用
- [ ] 检查并优化内存使用
- [ ] 检查并优化存储使用
- [ ] 检查并优化网络使用

### 6.2 成本优化
- [ ] 检查资源使用效率
- [ ] 优化自动扩展配置
- [ ] 检查备份策略
- [ ] 优化日志保留策略

## 7. 应急预案

### 7.1 常见问题处理
- [ ] 准备服务不可用解决方案
- [ ] 准备性能问题解决方案
- [ ] 准备数据问题解决方案
- [ ] 准备网络问题解决方案

### 7.2 联系信息
- [ ] 更新紧急联系人信息
- [ ] 更新技术支持信息
- [ ] 更新第三方服务联系信息
- [ ] 更新管理层联系信息 