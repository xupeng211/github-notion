# ğŸ” æµ‹è¯•ç›‘æ§é…ç½®
# é›†æˆæµ‹è¯•ç»“æœåˆ°ç›‘æ§ç³»ç»Ÿ

# Prometheus æŒ‡æ ‡é…ç½®
prometheus:
  metrics:
    # æµ‹è¯•æ‰§è¡ŒæŒ‡æ ‡
    test_execution_duration_seconds:
      type: histogram
      description: "æµ‹è¯•æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ"
      labels: ["test_type", "test_name", "status"]
      buckets: [0.1, 0.5, 1.0, 5.0, 10.0, 30.0, 60.0]
    
    test_success_total:
      type: counter
      description: "æµ‹è¯•æˆåŠŸæ¬¡æ•°"
      labels: ["test_type", "test_suite"]
    
    test_failure_total:
      type: counter
      description: "æµ‹è¯•å¤±è´¥æ¬¡æ•°"
      labels: ["test_type", "test_suite", "failure_reason"]
    
    # è¦†ç›–ç‡æŒ‡æ ‡
    code_coverage_percentage:
      type: gauge
      description: "ä»£ç è¦†ç›–ç‡ç™¾åˆ†æ¯”"
      labels: ["module", "test_type"]
    
    # æ€§èƒ½æŒ‡æ ‡
    performance_benchmark_duration_seconds:
      type: histogram
      description: "æ€§èƒ½åŸºå‡†æµ‹è¯•æ—¶é—´"
      labels: ["benchmark_name", "payload_size"]
      buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0]
    
    performance_throughput_ops_per_second:
      type: gauge
      description: "æ€§èƒ½ååé‡ (æ“ä½œ/ç§’)"
      labels: ["operation_type"]

# Grafana ä»ªè¡¨æ¿é…ç½®
grafana:
  dashboards:
    test_overview:
      title: "ğŸ§ª æµ‹è¯•æ¦‚è§ˆä»ªè¡¨æ¿"
      panels:
        - title: "æµ‹è¯•æ‰§è¡ŒçŠ¶æ€"
          type: stat
          targets:
            - expr: "sum(rate(test_success_total[5m]))"
              legend: "æˆåŠŸç‡"
        
        - title: "æµ‹è¯•è¦†ç›–ç‡è¶‹åŠ¿"
          type: graph
          targets:
            - expr: "code_coverage_percentage"
              legend: "{{module}} è¦†ç›–ç‡"
        
        - title: "æ€§èƒ½åŸºå‡†è¶‹åŠ¿"
          type: graph
          targets:
            - expr: "performance_benchmark_duration_seconds"
              legend: "{{benchmark_name}}"
    
    security_tests:
      title: "ğŸ” å®‰å…¨æµ‹è¯•ç›‘æ§"
      panels:
        - title: "å®‰å…¨æµ‹è¯•é€šè¿‡ç‡"
          type: stat
          targets:
            - expr: "rate(test_success_total{test_type='security'}[5m])"
        
        - title: "Webhook éªŒè¯æ€§èƒ½"
          type: graph
          targets:
            - expr: "performance_benchmark_duration_seconds{benchmark_name=~'webhook.*'}"

# å‘Šè­¦è§„åˆ™é…ç½®
alerting:
  rules:
    # æµ‹è¯•å¤±è´¥å‘Šè­¦
    test_failure_alert:
      alert: "TestFailureAlert"
      expr: "increase(test_failure_total[5m]) > 0"
      for: "1m"
      labels:
        severity: "critical"
        team: "development"
      annotations:
        summary: "æµ‹è¯•å¤±è´¥æ£€æµ‹"
        description: "{{ $labels.test_type }} æµ‹è¯•å¤±è´¥: {{ $labels.failure_reason }}"
    
    # è¦†ç›–ç‡ä¸‹é™å‘Šè­¦
    coverage_drop_alert:
      alert: "CoverageDropAlert"
      expr: "code_coverage_percentage < 50"
      for: "5m"
      labels:
        severity: "warning"
        team: "development"
      annotations:
        summary: "ä»£ç è¦†ç›–ç‡ä¸‹é™"
        description: "{{ $labels.module }} æ¨¡å—è¦†ç›–ç‡ä½äº 50%: {{ $value }}%"
    
    # æ€§èƒ½é€€åŒ–å‘Šè­¦
    performance_degradation_alert:
      alert: "PerformanceDegradationAlert"
      expr: "performance_benchmark_duration_seconds > 0.1"
      for: "2m"
      labels:
        severity: "warning"
        team: "development"
      annotations:
        summary: "æ€§èƒ½åŸºå‡†é€€åŒ–"
        description: "{{ $labels.benchmark_name }} æ€§èƒ½è¶…è¿‡é˜ˆå€¼: {{ $value }}s"

# Slack é€šçŸ¥é…ç½®
notifications:
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channels:
      development: "#development"
      alerts: "#alerts"
    
    templates:
      test_failure:
        title: "ğŸš¨ æµ‹è¯•å¤±è´¥é€šçŸ¥"
        color: "danger"
        fields:
          - title: "æµ‹è¯•ç±»å‹"
            value: "{{ .test_type }}"
            short: true
          - title: "å¤±è´¥åŸå› "
            value: "{{ .failure_reason }}"
            short: true
          - title: "æ—¶é—´"
            value: "{{ .timestamp }}"
            short: true
      
      coverage_report:
        title: "ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š"
        color: "good"
        fields:
          - title: "æ•´ä½“è¦†ç›–ç‡"
            value: "{{ .overall_coverage }}%"
            short: true
          - title: "å˜åŒ–"
            value: "{{ .coverage_change }}"
            short: true

# GitHub é›†æˆé…ç½®
github:
  status_checks:
    # å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥
    required_checks:
      - "security-tests"
      - "core-business-tests"
      - "api-integration-tests"
      - "comprehensive-tests"
    
    # çŠ¶æ€æ£€æŸ¥é…ç½®
    contexts:
      security_tests:
        context: "tests/security"
        description: "å®‰å…¨æµ‹è¯•çŠ¶æ€"
        target_url: "${GITHUB_ACTIONS_URL}"
      
      coverage_check:
        context: "coverage/overall"
        description: "ä»£ç è¦†ç›–ç‡æ£€æŸ¥"
        target_url: "${CODECOV_URL}"

# æµ‹è¯•æŠ¥å‘Šé…ç½®
reporting:
  # æ¯æ—¥æµ‹è¯•æŠ¥å‘Š
  daily_report:
    enabled: true
    schedule: "0 9 * * *"  # æ¯å¤©ä¸Šåˆ9ç‚¹
    recipients:
      - "team@company.com"
    
    content:
      - test_summary
      - coverage_trends
      - performance_metrics
      - failure_analysis
  
  # å‘¨åº¦è´¨é‡æŠ¥å‘Š
  weekly_report:
    enabled: true
    schedule: "0 9 * * 1"  # æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹
    recipients:
      - "team@company.com"
      - "management@company.com"
    
    content:
      - quality_metrics
      - coverage_analysis
      - performance_trends
      - improvement_recommendations

# æ•°æ®ä¿ç•™ç­–ç•¥
retention:
  metrics:
    short_term: "7d"    # è¯¦ç»†æŒ‡æ ‡ä¿ç•™7å¤©
    long_term: "90d"    # èšåˆæŒ‡æ ‡ä¿ç•™90å¤©
  
  test_results:
    detailed: "30d"     # è¯¦ç»†æµ‹è¯•ç»“æœä¿ç•™30å¤©
    summary: "1y"       # æµ‹è¯•æ‘˜è¦ä¿ç•™1å¹´
  
  performance_data:
    benchmarks: "90d"   # æ€§èƒ½åŸºå‡†æ•°æ®ä¿ç•™90å¤©
    trends: "1y"        # æ€§èƒ½è¶‹åŠ¿æ•°æ®ä¿ç•™1å¹´
